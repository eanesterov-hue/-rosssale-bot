V1 Match: объект → список брокеров по показам

Зачем делаем

В компании процесс кросс-продаж между брокерами сейчас работает в основном в одну сторону: когда есть клиент → брокер находит объект через WhiteList.
Обратная сторона (появился объект/собственник → найти, у каких брокеров есть активные клиенты под этот объект) делается вручную через чаты и зависит от памяти/инициативы брокера.

V1 решает самый узкий и быстрый кейс: если по этому ЖК/объекту уже идут показы, значит у других брокеров есть “живые” клиенты, и брокеру по объекту нужно быстро увидеть, к кому идти внутри компании.

Что такое V1 (строго)

Локальная утилита, которая по выгрузке “Показы” из AmoCRM возвращает только одно:

уникальный список имён брокеров, которые делали показы по заданному объекту/ЖК за выбранный период.

Никаких счётчиков, дат, рейтингов, “теплоты”, исключений “уже показывали этого собственника” — это версии V2+.

Источник данных

Выгрузка “Показы” из AmoCRM (аналитика), таблица со столбцами:
	•	№ (не используем)
	•	Брокер (используем)
	•	Дата (используем для фильтра периода)
	•	Объект (ключ для поиска/матчинга)
	•	Статус (в V1 опционально; можно не фильтровать)

Пример реальных строк (в данных есть дубликаты и вариативность названий):
	•	Дубликаты по брокеру/объекту встречаются (Агаларов 2 раза, Primavera 3 раза, ВТБ Арена парк 2 раза).
	•	Названия объектов могут различаться: например Прайм парк и Прайм парк вторичка — по смыслу близко, но в данных это разные строки.

Ключевые нюансы данных (важно учесть сразу)
	1.	Дубликаты
Один и тот же брокер может встречаться много раз — вывод должен быть уникальным списком.
	2.	Вариативность названий объектов
Возможны:

	•	разный регистр (Prime Park vs Прайм парк)
	•	хвосты/приписки (Прайм парк вторичка)
	•	пробелы/опечатки (West garden)

Поэтому в V1 закладываем два режима поиска:
	•	exact — точное совпадение (по умолчанию, безопасно)
	•	contains — объект считается совпавшим, если строка “Объект” содержит запрос (для случаев “Прайм парк” должен поймать и “Прайм парк вторичка”)
Плюс нормализация: trim + lower + схлопывание двойных пробелов.

	3.	Статус
В примере везде Завершен. В реальности могут быть Запланирован, Отменен и т.п.
В V1: статус не обязателен, но полезно иметь флаг --exclude-status "Отменен" (по умолчанию можно ничего не исключать).
	4.	Дата
Период задаётся параметром days (по умолчанию 14). Если выгрузка уже сделана за нужный период — фильтр по дате можно не отключать, но он всё равно должен корректно работать.

Входы и выходы

Вход (CLI / локально)
	•	--file путь к выгрузке .xlsx или .csv
	•	--object строка запроса (например: Прайм парк)
	•	--days период (по умолчанию 14)
	•	--match режим: exact или contains (по умолчанию exact)
	•	--exclude-status опционально (по умолчанию пусто / не применять)

Выход
	1.	Текстовый список:

Объект: Прайм парк
Период: 14 дней
Брокеры:
- Ирина Партионова
- Алиса Мяктинова

	2.	(опционально) JSON для будущего интерфейса (Telegram / web):

{"object":"Прайм парк","days":14,"match":"contains","brokers":["...","..."]}

Логика V1 (алгоритм)
	1.	Загрузить файл (xlsx/csv).
	2.	Нормализовать колонки, убедиться, что есть Брокер, Дата, Объект.
	3.	Привести Дата к date/datetime.
	4.	Нормализовать строки Объект и входной запрос.
	5.	Отфильтровать строки:
	•	по дате Дата >= today - days
	•	по объекту:
	•	exact: normalized_object == normalized_query
	•	contains: normalized_query in normalized_object
	•	(опционально) исключить статус
	6.	Взять Брокер → trim → удалить пустые → unique → отсортировать → вывести.

MVP-результат (критерий готовности)

V1 считается готовым, если на примере данных:
	•	запрос --object "Агаларов" возвращает одного брокера Надежда Тюваева (несмотря на 2 строки)
	•	запрос --object "Primavera" возвращает Юлия Пименова (несмотря на 3 строки)
	•	запрос --object "Прайм парк" --match contains возвращает Ирина Партионова и Алиса Мяктинова (потому что ловим и “Прайм парк вторичка”)

Ограничения (осознанно)
	•	Не пытаемся матчить “по бюджету/комнатности/району”.
	•	Не читаем комментарии/звонки/теги.
	•	Не учитываем, показывали ли уже конкретный объект этому брокеру (исключения — V2).
	•	Не делаем UI: только локальный инструмент + формат данных, готовый для будущего интерфейса.

План развития после V1 (коротко)
	•	V2: исключать брокеров, которые уже показывали конкретный объект/собственника.
	•	V3: расширять сигналами из звонков/заметок/тегов (если появятся транскрипты и структура).

⸻
